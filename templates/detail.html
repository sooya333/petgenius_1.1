<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html"
      xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <title>Pet Genius ìƒì„¸ë³´ê¸°</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico"/>
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css"/>
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet"
          type="text/css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="../static/css/styles.css" rel="stylesheet"/>
    <script src="/static/js/scripts.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>


    <script>
        <!--í˜ì´ì§€ ì—´ìë§ˆì ì‹¤í–‰-->
        $(document).ready(function () {
            show_detail()
            show_cmt()
            $('#c_name').on('input', processkey);
            $('#comment').on('input', processkey);
            processkey();
        });

        // ê¸°ë¡ëœ ëŒ“ê¸€ë“¤ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
        function show_cmt() {
            let urlParams = new URLSearchParams(window.location.search);
            let num = urlParams.get("num");
            $.ajax({
                type: "GET",
                url: "/comment",
                data: {'num': num},
                success: function (response) {
                    console.log(response['cmt_list'])
                    let rows = response['cmt_list']
                    for (let i = 0; i < rows.length; i++) {
                        let name = rows[i]['name']
                        let comment = rows[i]['comment']
                        let datetime = rows[i]['created_date']
                        console.log(datetime)

                        let temp_html = `<div class="row bg-light mb-1">
                                    <div class="p-3 col-sm-3" style="background-color: #778899;">
                                        <span class="pt-5" style="color: white;">${name}</span>
                                    </div>
                                    <div class="p-3 col-sm-9">
                                        <span>${comment}</span><br>
                                        <small class="float-sm-end" style="color:lightgray;">${datetime}</small>
                                    </div>
                                </div>`
                        $('#cmt_box').prepend(temp_html)
                    }
                }
            })
        }

        // ì‘ì„±í•œ&í´ë¦­í•œ ê¸€ì˜ ë””í…Œì¼ì„ dbì—ì„œ ê°€ì ¸ì™€ì„œ ìƒì„¸í˜ì´ì§€ì— ë¶™ì—¬ì£¼ëŠ” í‘ì…˜
        function show_detail() {
            let urlParams = new URLSearchParams(window.location.search);
            let num = urlParams.get("num");
            $.ajax({
                type: "GET",
                url: "/detail",
                data: {'num': num},
                success: function (response) {
                    let detail = response.detail
                    //
                    // let image = detail['image']
                    // let category = detail['category']
                    // let role = detail['role']
                    // let region = detail['region']
                    // let title = detail['title']
                    // let name = detail['name']
                    // let content = detail['content']
                    // let file = detail['file']
                    // let time = detail['time']
                    //
                    // // alert(name+" "+title)
                    //
                    // let temp_html = ` <div>
                    //
                    //                        <span class="badge bg-primary">${category}</span>
                    //                        <span class="badge bg-success">${role}</span>
                    //                        <span class="badge bg-warning">${region}</span>
                    //                   </div>
                    //                   </br>
                    //                   </br>
                    //                   <div class="mb-3">
                    //                        <label for="Date" class="form-label">ì‘ì„±ì¼</label>
                    //                        <p class="form-datecontrol">${time} </p>
                    //                        <label for="name" class="form-label">ì‘ì„±ì</label>
                    //                        <p class="form-control">${name} </p>
                    //                   </div>
                    //                   </br>
                    //                    <div class="test1">
                    //                         <label for="title" class="form-label">ì œëª©</label>
                    //                         <p class="form-control" id="title">${title}</p>
                    //                         </br>
                    //                         <label for="content" class="form-label">ë‚´ìš©</label>
                    //                         <textarea class="form-control" id="content" name="content" disabled>${content}</textarea>
                    //                         <img src="http://www.example.com/images/image.jpg" alt="image">
                    //                    </div>`
                    // $('#detail_box').append(temp_html)

                }
            })
        }

        //ëŒ“ê¸€ part : ë‹‰ë„¤ì„ + ë‚´ìš© ëª¨ë‘ ì‘ì„±í•  ê²½ìš°ì—ë§Œ save ë²„íŠ¼ í´ë¦­
        function processkey() {
            if ($('#c_name').val() == '' || $('#comment').val() == '') {
                $('#submitButton').attr("disabled", true);
            } else {
                $('#submitButton').attr("disabled", false);
            }
        }

        // ëŒ“ê¸€ ë“±ë¡í•˜ê¸°
        function save_cmt() {
            let urlParams = new URLSearchParams(window.location.search);
            let b_num = urlParams.get("num");
            let name = $('#c_name').val();
            let comment = $('#comment').val()

            let today = new Date()
            let date = today.toLocaleDateString()
            let time = today.toLocaleTimeString('en-GB', {hourCycle: 'h23'})
            today = date + " " + time
            console.log(b_num, name, comment, today)
            let value = confirm('ëŒ“ê¸€ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë“±ë¡ ì‹œ, ìˆ˜ì •&ì‚­ì œê°€ ì–´ë µìŠµë‹ˆë‹¤.');
            if (value == true) {
                // alert(name, comment, b_num)
                $.ajax({
                    type: "POST",
                    url: "/detail", // *** ì¶”í›„ ê²Œì‹œê¸€ numë„ ê°€ì ¸ì˜¤ê¸°!!!! ****ã„´
                    data: {b_num_give: b_num, name_give: name, comment_give: comment, date_give: today}, //ì €ì¥ëœ ë‹‰ë„¤ì„ê³¼ ëŒ“ê¸€ë‚´ìš© ë„˜ê¸°ê¸°
                    success: function (response) {
                        alert(response['msg']) //ëŒ“ê¸€ì´ ë“±ë¡ë˜ë©´ ì™„ë£Œë©”ì„¸ì§€ ë³´ë‚´ê¸°
                        window.location.reload() //ëŒ“ê¸€ ë“±ë¡ í›„ ìƒˆë¡œê³ ì¹¨ ì‹œí–‰
                        // location.href = "/detail?num=" + b_num + "#dividers"
                    }
                })
            } else if (value == false) {
                return;
            }
        }

    </script>

    <style>


        . title {
            font-size: 10px;
        }

        .form-datecontrol {
            font-size: 13px;
            color: black;
            font-weight: bold;
        }

        .form-control {
            font-size: 15px;
        }

        .form-label {
            font-size: 15px;
            margin-top: 10px;
            font-weight: bold;
        }


    </style>

</head>

<body>
<!-- Navigation-->
<nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav">
    <div class="container">
        <a class="navbar-brand" href="/">PET GENIUS</a>
        <button class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded" type="button"
                data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive"
                aria-expanded="false" aria-label="Toggle navigation">
            Menu
            <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded"
                                                     href="/#portfolio">ê²Œì‹œíŒ</a>
                </li>
                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded"
                                                     href="/write">ê¸€ ì‘ì„±í•˜ê¸°</a></li>
            </ul>
        </div>
    </div>
</nav>

<!-- ì´ë¯¸ì§€ë°°ë„ˆ-->

<header class="bg-primary">
    <img class="banner" src="/static/img/banner/banner_details.png" alt="í«ì§€ë‹ˆì–´ìŠ¤ ìƒì„¸í˜ì´ì§€"/>
</header>
</br>
<!-- Input Section-->
<section class="page-section" id="contact">
    <div class="container">
        <!-- Contact Section Heading-->
        <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">ê²Œì‹œê¸€</h2>
        <!-- Icon Divider-->
        <div class="divider-custom">
            <div class="divider-custom-line"></div>
            <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
            <div class="divider-custom-line"></div>
        </div>
        <!-- Contact Section Form-->

        </br>
        <!--        ê°€ì ¸ì˜¨ ë°ì´í„°ê°€ ë¶™ëŠ” ê³³ -->
        <!--        <div id="detail_box" style="max-width: 800px;" class="container">-->
        <div class="new_container" id="detail_box" style="max-width: 800px;">

            <p style="text-align:left;">
                {% if detail.category == "ë„ì™€ ì£¼ì„¸ìš”" %}
                <span class="badge bg-danger">{{ detail.category }}</span>
                {% else %}
                <span class="badge bg-warning">{{ detail.category }}</span>
                {% endif %}

                {% if detail.role == "ë°˜ë ¤ê²¬ í›ˆë ¨ì‚¬" %}
                <span class="badge bg-primary">{{ detail.role }}</span>
                {% else %}
                <span class="badge bg-info">{{ detail.role }}</span>
                {% endif %}
                <span class="badge bg-dark">{{ detail.region }}</span>
            </p>

            <!--<label for="title" class="form-label"></label>-->
            <p id="title" style="color: black; font-weight: bold; font-size: 30px; padding: 10px;">
                {{ detail.title }}
            </p>

            <h6 style="text-align:right;">
                ì‘ì„±ì:&nbsp;{{ detail.name }}&nbsp;&nbsp;ì‘ì„±ì¼:&nbsp;{{ detail.time }}
            </h6>

            <!--<label for="Date"></label>
            <p class="" id="Date">{{ detail.time }} </p>
            <label for="name">ì‘ì„±ì:</label>
            <p class="" id="name">{{ detail.name }}</p>-->


            <div style="text-align: center;">
                <img width="800px" src="data:image/*;base64,{{ encoded_string }}"/>

            </div>
            </br>
            <div>
                <!--            <label for="content" class="form-label">ë‚´ìš©</label>-->
                <p style="width: 800px; background-color: gainsboro; border-radius: 0.5em; padding: 3rem;" id="content"
                   name="content">
                    {{ detail.content }}</p>
            </div>

        </div>
    </div>

    <!--ëŒ“ê¸€ ì„¹ì…˜ ì‹œì‘!-->

    <section class="page-section container" id="comment_list" style="max-width: 800px;">
        <h2 style="text-align: center">ëŒ“ê¸€</h2>
        <!-- Icon Divider-->
        <div class="divider-custom" id="dividers">
            <div class="divider-custom-line"></div>
            <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
            <div class="divider-custom-line"></div>
        </div>

        <!-- ëŒ“ê¸€ ì£¼ì˜ì‚¬í•­ -->
        <div class="p-3" style="background-color: lemonchiffon; border-radius: 0.5em; ">
            <div>
                <p style="font-weight: bold">ğŸ’¡ ëŒ“ê¸€ ì‘ì„±ì‹œ ì£¼ì˜ì‚¬í•­</p>
                <small>ì†Œì¤‘í•œ ê°œì¸ì •ë³´ ë…¸ì¶œì„ ìœ ì˜í•´ ì£¼ì„¸ìš”! ì—°ë½ì´ í•„ìš”í•˜ë‹¤ë©´ ê°œì¸ ì „í™”ë²ˆí˜¸ë¥¼ ê³µìœ í•˜ê¸°ë³´ë‹¤ ì¹´ì¹´ì˜¤í†¡ IDë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”.</small>
            </div>
        </div>

        <!-- ëŒ“ê¸€ ì…ë ¥ì°½ -->
        <form class="row">
            <!-- Name input-->
            <div class="form-floating col-sm-3 mx-auto mb-3">
                <input type="text" class="form-control" placeholder="Enter name" id="c_name" required>
                <label for="c_name">ë‹‰ë„¤ì„</label>
            </div>
            <!-- comment input-->
            <div class="form-floating col-sm-7 mx-auto mb-3">
                <input type="text" class="form-control" placeholder="Enter comment" id="comment" required>
                <label for="comment">ëŒ“ê¸€ë‚´ìš©</label>
            </div>

            <!-- Submit Button-->
            <button class="btn btn-outline-primary mx-auto col-sm-1 mt-5" id="submitButton" type="submit"
                    disabled="true" onclick="save_cmt()" style=" height: 40px; width: 70px">ë“±ë¡
            </button>
        </form>
        </br>


        <!--ê¸°ì¡´ ëŒ“ê¸€ ë³´ì—¬ì£¼ê¸° // -->
        <div class="container" style="max-width: 1000px;" id="cmt_box">
        </div>
        <br>
        <div>
            <button type='button' class="btn btn-primary"
                    onclick="javascript : location.href='/#portfolio'">ë©”ì¸í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
        </div>
    </section>


</section>
<!-- Footer (ìˆ˜ì •X)-->
<footer class="footer text-center">
    <div class="container">
        <div class="row">
            <!-- Contact -->
            <div class="col-lg-4 mb-5 mb-lg-0">
                <h4 class="text-uppercase mb-4" style="color: lightslategray">CONTACT</h4>
                <p class="lead mb-0">
                    info@petgenius.com
                    <br/>
                    +82 - 2 - 123 - 5678
                </p>
            </div>
            <!-- Social Icons-->
            <div class="col-lg-4 mb-5 mb-lg-0">
                <h4 class="text-uppercase mb-4" style="color: lightslategray">Social Media</h4>
                <p class="lead">KakaoTalk
                    <a class="btn btn-outline-light btn-social mx-2" target="_blank"
                       href="https://open.kakao.com/o/siarMh2e">
                        <i class="fa-solid fa-comment"></i>
                    </a>
                </p>
            </div>
            <!-- About Text-->
            <div class="col-lg-4">
                <h4 class="text-uppercase mb-4" style="color: lightslategray">About PET GENIUS</h4>
                <p class="mb-0">
                    ë°˜ë ¤ê²¬ì„ í‚¤ìš°ê³  ìˆì§€ë§Œ ì‰½ì§€ ì•Šì€ ë‚˜ë‚ ë“¤! <br>
                    í«ì‹œí„°ë‚˜ íŠ¸ë ˆì´ë„ˆë¥¼ ë§Œë‚˜ê³  ì‹¶ì§€ë§Œ ì–´ë””ì„œ ë§Œë‚˜ì•¼ í• ì§€ <br>
                    ì–´ë–¤ ì •ë³´ë¥¼ ë´ì•¼ í• ì§€ ëª¨ë¥´ëŠ” ë¶„ë“¤ì„ ìœ„í•œ ì»¤ë®¤ë‹ˆí‹° í”Œë«í¼
                </p>
            </div>
        </div>
    </div>
</footer>
<!-- Copyright (ìˆ˜ì •X)-->
<div class="copyright py-4 text-center text-white">
    <div class="container">
        <small>Seoul, Republic of Korea</small><br>
        <small>Copyright &copy; SWCampB03 2023</small>
    </div>
</div>

</body>
</html>